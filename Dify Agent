<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GreenRide</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, sans-serif; background: #f3f4f6; }
    #chat { max-height: 70vh; overflow-y: auto; padding: 1rem; }
    .bubble { max-width: 80%; padding: 14px 18px; border-radius: 20px; margin-bottom: 12px; }
    .user { background: #10b981; color: white; align-self: flex-end; }
    .agent { background: #e5e7eb; color: black; align-self: flex-start; }
  </style>
</head>
<body class="min-h-screen flex flex-col">

<header class="bg-green-600 text-white p-4 text-center">
  <h1 class="text-3xl font-bold">ğŸš— GreenRide</h1>
  <p class="text-sm opacity-90">Dein persÃ¶nlicher Fahrt-Assistent</p>
</header>

<main class="flex-1 p-4 max-w-3xl mx-auto flex flex-col">
  <div id="chat" class="flex flex-col space-y-4 bg-white rounded-3xl shadow p-4 flex-1"></div>

  <div class="mt-4 flex gap-2">
    <input id="input" type="text" placeholder="Schreib deine Nachricht..." 
           class="flex-1 p-4 border rounded-full focus:outline-none focus:ring-4 focus:ring-green-200">
    <button onclick="sendMessage()" 
            class="bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-full font-bold">Senden</button>
  </div>
</main>

<script>
  // â†â†â† HIER DEINE DATEN EINFÃœGEN
  const API_URL = "https://api.dify.ai/v1/chat-messages";
  const API_KEY = "app-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";   // â† Dein Key hier rein!
  // â†â†â† ENDE

  let conversationId = null;

  function addMessage(text, isUser) {
    const chat = document.getElementById('chat');
    const div = document.createElement('div');
    div.className = `bubble ${isUser ? 'user' : 'agent'}`;
    div.innerHTML = text.replace(/\n/g, '<br>');
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  async function sendMessage() {
    const input = document.getElementById('input');
    const msg = input.value.trim();
    if (!msg) return;

    addMessage(msg, true);           // User-Nachricht
    input.value = '';

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${API_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          query: msg,
          response_mode: "blocking",
          conversation_id: conversationId || "",
          user: "web-user"
        })
      });

      const data = await res.json();

      addMessage(data.answer || "Fehler â€“ keine Antwort", false);

      if (data.conversation_id) conversationId = data.conversation_id;

    } catch (e) {
      addMessage("Verbindung fehlgeschlagen ğŸ˜” (API-Key oder Internet prÃ¼fen)", false);
    }
  }

  // Enter-Taste
  document.getElementById('input').addEventListener('keypress', e => {
    if (e.key === "Enter") sendMessage();
  });

  // BegrÃ¼ÃŸung beim Laden
  window.onload = () => {
    addMessage("Hallo! ğŸš— Willkommen bei GreenRide!<br>Wo mÃ¶chtest du abgeholt werden?", false);
  };
</script>
</body>
</html>
